<!-- í†µí•©ëœ ì—¬ì • & ì¸ì‚¬ì´íŠ¸ íƒ­ -->
<section class="tab-content" id="journey-insights-tab" role="tabpanel" aria-labelledby="journey-insights-tab-button">
    <div class="journey-insights-content">
        <!-- í—¤ë” ì„¹ì…˜ -->
        <div class="section-header">
            <h2>ğŸŒŸ ë‚˜ì˜ ë²„í‚·ë¦¬ìŠ¤íŠ¸ ì—¬ì •</h2>
            <p>ì§€ê¸ˆê¹Œì§€ì˜ ì„±ê³¼ì™€ íŒ¨í„´ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
            
            <!-- ê¸°ê°„ í•„í„° -->
            <div class="period-filter">
                <button class="period-btn active" data-period="all">ì „ì²´</button>
                <button class="period-btn" data-period="year">ì˜¬í•´</button>
                <button class="period-btn" data-period="quarter">ë¶„ê¸°</button>
                <button class="period-btn" data-period="month">ì´ë²ˆë‹¬</button>
            </div>
        </div>

        <!-- í•µì‹¬ ì§€í‘œ ëŒ€ì‹œë³´ë“œ -->
        <div class="metrics-dashboard">
            <!-- ì „ì²´ ì§„í–‰ë¥  (í¬ê³  ì‹œê°ì ìœ¼ë¡œ ê°•ì¡°) -->
            <div class="main-progress-card">
                <div class="circular-progress" data-progress="0">
                    <svg viewBox="0 0 200 200">
                        <circle cx="100" cy="100" r="90" />
                        <circle cx="100" cy="100" r="90" class="progress-ring" />
                    </svg>
                    <div class="progress-content">
                        <div class="progress-value">0%</div>
                        <div class="progress-label">ì „ì²´ ë‹¬ì„±ë¥ </div>
                    </div>
                </div>
                
                <!-- ë¹ ë¥¸ í†µê³„ -->
                <div class="quick-stats">
                    <div class="stat-item">
                        <span class="stat-icon">ğŸ¯</span>
                        <span class="stat-value" id="totalGoals">0</span>
                        <span class="stat-label">ì „ì²´ ëª©í‘œ</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">âœ…</span>
                        <span class="stat-value" id="completedGoals">0</span>
                        <span class="stat-label">ë‹¬ì„± ì™„ë£Œ</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">ğŸ”¥</span>
                        <span class="stat-value" id="activeStreak">0ì¼</span>
                        <span class="stat-label">ì—°ì† í™œë™</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-icon">ğŸ’ª</span>
                        <span class="stat-value" id="avgMotivation">0</span>
                        <span class="stat-label">í‰ê·  ë™ê¸°</span>
                    </div>
                </div>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ë³„ ë¶„ì„ (ì‹œê°ì  + ìˆ˜ì¹˜ì ) -->
            <div class="category-analysis-card">
                <h3>ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼</h3>
                <div class="category-chart-container">
                    <canvas id="categoryRadarChart"></canvas>
                </div>
                <div class="category-details">
                    <!-- ê° ì¹´í…Œê³ ë¦¬ë³„ ì§„í–‰ë¥  ë°” -->
                    <div class="category-item" data-category="travel">
                        <div class="category-header">
                            <span class="category-icon">ğŸŒ</span>
                            <span class="category-name">ì—¬í–‰</span>
                            <span class="category-stats">0/0</span>
                        </div>
                        <div class="category-progress-bar">
                            <div class="category-progress-fill" style="width: 0%"></div>
                        </div>
                    </div>
                    <!-- ë‹¤ë¥¸ ì¹´í…Œê³ ë¦¬ë“¤ë„ ë™ì¼í•œ êµ¬ì¡° -->
                </div>
            </div>
        </div>

        <!-- ì‹œê°„ì¶• ë¶„ì„ (íƒ€ì„ë¼ì¸ + íŠ¸ë Œë“œ) -->
        <div class="timeline-analysis">
            <div class="timeline-header">
                <h3>ğŸ“ˆ ì‹œê°„ë³„ ë‹¬ì„± íŒ¨í„´</h3>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="timeline">íƒ€ì„ë¼ì¸</button>
                    <button class="view-btn" data-view="heatmap">íˆíŠ¸ë§µ</button>
                    <button class="view-btn" data-view="trend">íŠ¸ë Œë“œ</button>
                </div>
            </div>
            
            <!-- íƒ€ì„ë¼ì¸ ë·° -->
            <div class="timeline-view active" id="timelineView">
                <div class="achievement-timeline" id="achievementTimeline">
                    <!-- ë‹¬ì„± ëª©í‘œë“¤ì´ ì‹œê°„ìˆœìœ¼ë¡œ í‘œì‹œ -->
                </div>
            </div>
            
            <!-- íˆíŠ¸ë§µ ë·° -->
            <div class="heatmap-view" id="heatmapView" style="display: none;">
                <div class="year-heatmap">
                    <!-- GitHub ìŠ¤íƒ€ì¼ í™œë™ íˆíŠ¸ë§µ -->
                </div>
            </div>
            
            <!-- íŠ¸ë Œë“œ ì°¨íŠ¸ ë·° -->
            <div class="trend-view" id="trendView" style="display: none;">
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <!-- ê°ì • & ë™ê¸° ë¶„ì„ -->
        <div class="emotion-motivation-analysis">
            <h3>ğŸ˜Š ê°ì • & ë™ê¸° íŒ¨í„´</h3>
            <div class="analysis-grid">
                <!-- ê°ì • ë¶„í¬ -->
                <div class="emotion-distribution">
                    <h4>ì£¼ìš” ê°ì • ë¶„í¬</h4>
                    <canvas id="emotionPieChart"></canvas>
                    <div class="emotion-insights">
                        <p class="insight-text" id="emotionInsight">
                            <!-- AIê°€ ë¶„ì„í•œ ê°ì • íŒ¨í„´ ì¸ì‚¬ì´íŠ¸ -->
                        </p>
                    </div>
                </div>
                
                <!-- ë™ê¸° ë³€í™” ì¶”ì´ -->
                <div class="motivation-trend">
                    <h4>ë™ê¸° ì§€ìˆ˜ ë³€í™”</h4>
                    <canvas id="motivationLineChart"></canvas>
                    <div class="motivation-insights">
                        <p class="insight-text" id="motivationInsight">
                            <!-- ë™ê¸° íŒ¨í„´ì— ëŒ€í•œ ì¸ì‚¬ì´íŠ¸ -->
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸ & ì¶”ì²œ -->
        <div class="personalized-insights">
            <h3>ğŸ’¡ ë§ì¶¤í˜• ì¸ì‚¬ì´íŠ¸</h3>
            <div class="insight-cards">
                <!-- ê°•ì  ë¶„ì„ -->
                <div class="insight-card strength">
                    <div class="insight-icon">ğŸ’ª</div>
                    <h4>ë‹¹ì‹ ì˜ ê°•ì </h4>
                    <p id="strengthAnalysis">ì¹´í…Œê³ ë¦¬ ë¶„ì„ ì¤‘...</p>
                </div>
                
                <!-- íŒ¨í„´ ë°œê²¬ -->
                <div class="insight-card pattern">
                    <div class="insight-icon">ğŸ”</div>
                    <h4>ë°œê²¬ëœ íŒ¨í„´</h4>
                    <p id="patternAnalysis">íŒ¨í„´ ë¶„ì„ ì¤‘...</p>
                </div>
                
                <!-- ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ -->
                <div class="insight-card suggestion">
                    <div class="insight-icon">ğŸ¯</div>
                    <h4>ì¶”ì²œ ë‹¤ìŒ ë‹¨ê³„</h4>
                    <p id="nextStepSuggestion">ë¶„ì„ ì¤‘...</p>
                </div>
            </div>
        </div>

        <!-- ë‹¬ì„± ì˜ˆì¸¡ & ëª©í‘œ -->
        <div class="achievement-forecast">
            <h3>ğŸ”® ë‹¬ì„± ì˜ˆì¸¡</h3>
            <div class="forecast-content">
                <div class="forecast-chart">
                    <canvas id="forecastChart"></canvas>
                </div>
                <div class="forecast-details">
                    <div class="forecast-item">
                        <span class="forecast-label">í˜„ì¬ ì†ë„ë¡œ ê³„ì†í•˜ë©´</span>
                        <span class="forecast-value" id="expectedCompletion">-</span>
                    </div>
                    <div class="forecast-item">
                        <span class="forecast-label">100% ë‹¬ì„± ì˜ˆìƒì¼</span>
                        <span class="forecast-value" id="completionDate">-</span>
                    </div>
                    <div class="forecast-item">
                        <span class="forecast-label">ê¶Œì¥ ì£¼ê°„ ëª©í‘œ</span>
                        <span class="forecast-value" id="weeklyTarget">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="exportJourneyReport()">
                ğŸ“„ ì—¬ì • ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ
            </button>
            <button class="btn btn-secondary" onclick="shareJourneyHighlights()">
                ğŸ”— í•˜ì´ë¼ì´íŠ¸ ê³µìœ 
            </button>
            <button class="btn btn-secondary" onclick="setNewGoals()">
                ğŸ¯ ìƒˆ ëª©í‘œ ì„¤ì •
            </button>
        </div>
    </div>
</section>

<style>
/* í†µí•©ëœ ì—¬ì • & ì¸ì‚¬ì´íŠ¸ ìŠ¤íƒ€ì¼ */
.journey-insights-content {
    padding: 20px 0;
}

.section-header {
    text-align: center;
    margin-bottom: 40px;
}

.period-filter {
    display: flex;
    gap: 10px;
    justify-content: center;
    margin-top: 20px;
}

.period-btn {
    padding: 8px 20px;
    border: 1px solid #e0e0e0;
    background: white;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s;
}

.period-btn.active {
    background: #007AFF;
    color: white;
    border-color: #007AFF;
}

.metrics-dashboard {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 40px;
}

.main-progress-card {
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.circular-progress {
    width: 200px;
    height: 200px;
    position: relative;
    margin: 0 auto 20px;
}

.circular-progress svg {
    transform: rotate(-90deg);
}

.circular-progress circle {
    fill: none;
    stroke-width: 12;
}

.circular-progress circle:first-child {
    stroke: #f0f0f0;
}

.progress-ring {
    stroke: #007AFF;
    stroke-dasharray: 565.48;
    stroke-dashoffset: 565.48;
    transition: stroke-dashoffset 1s ease;
}

.progress-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.progress-value {
    font-size: 48px;
    font-weight: 700;
    color: #007AFF;
}

.quick-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-top: 30px;
}

.stat-item {
    text-align: center;
}

.stat-icon {
    font-size: 24px;
    display: block;
    margin-bottom: 5px;
}

.stat-value {
    font-size: 24px;
    font-weight: 600;
    display: block;
}

.stat-label {
    font-size: 13px;
    color: #666;
}

.category-analysis-card {
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.category-chart-container {
    width: 250px;
    height: 250px;
    margin: 20px auto;
}

.category-item {
    margin-bottom: 20px;
}

.category-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 8px;
}

.category-icon {
    font-size: 20px;
}

.category-name {
    flex: 1;
    font-weight: 500;
}

.category-stats {
    color: #666;
    font-size: 14px;
}

.category-progress-bar {
    height: 8px;
    background: #f0f0f0;
    border-radius: 4px;
    overflow: hidden;
}

.category-progress-fill {
    height: 100%;
    background: linear-gradient(to right, #007AFF, #5856D6);
    transition: width 0.5s ease;
}

.timeline-analysis {
    background: white;
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.view-toggle {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.view-btn {
    padding: 6px 16px;
    border: 1px solid #e0e0e0;
    background: white;
    border-radius: 15px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
}

.view-btn.active {
    background: #007AFF;
    color: white;
    border-color: #007AFF;
}

.emotion-motivation-analysis {
    background: white;
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.analysis-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-top: 20px;
}

.personalized-insights {
    margin-bottom: 30px;
}

.insight-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.insight-card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    transition: transform 0.2s;
}

.insight-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.12);
}

.insight-icon {
    font-size: 32px;
    margin-bottom: 10px;
}

.insight-card h4 {
    font-size: 18px;
    margin-bottom: 10px;
}

.achievement-forecast {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 20px;
    padding: 30px;
    margin-bottom: 30px;
}

.forecast-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-top: 20px;
}

.forecast-item {
    display: flex;
    justify-content: space-between;
    padding: 10px 0;
    border-bottom: 1px solid rgba(255,255,255,0.2);
}

.forecast-label {
    opacity: 0.9;
}

.forecast-value {
    font-weight: 600;
    font-size: 18px;
}

.action-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 40px;
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 768px) {
    .metrics-dashboard {
        grid-template-columns: 1fr;
    }
    
    .analysis-grid {
        grid-template-columns: 1fr;
    }
    
    .forecast-content {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
    }
}
</style>

<script>
// í†µí•©ëœ ì—¬ì • & ì¸ì‚¬ì´íŠ¸ JavaScript
function initJourneyInsights() {
    // ë°ì´í„° ë¡œë“œ ë° ì°¨íŠ¸ ì´ˆê¸°í™”
    const stats = DataModel.getStats();
    const goals = DataModel.state.currentProfile?.bucketList || [];
    
    // ì „ì²´ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    updateCircularProgress(stats.percentage);
    
    // ë¹ ë¥¸ í†µê³„ ì—…ë°ì´íŠ¸
    document.getElementById('totalGoals').textContent = stats.total;
    document.getElementById('completedGoals').textContent = stats.completed;
    document.getElementById('activeStreak').textContent = calculateStreak() + 'ì¼';
    document.getElementById('avgMotivation').textContent = stats.motivationIndex;
    
    // ì°¨íŠ¸ ì´ˆê¸°í™”
    initCategoryRadarChart(stats.byCategory);
    initEmotionPieChart(goals);
    initMotivationLineChart(goals);
    initTrendChart(goals);
    initForecastChart(stats);
    
    // ì¸ì‚¬ì´íŠ¸ ìƒì„±
    generatePersonalizedInsights(goals, stats);
}

// ì›í˜• ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
function updateCircularProgress(percentage) {
    const progressRing = document.querySelector('.progress-ring');
    const radius = progressRing.r.baseVal.value;
    const circumference = radius * 2 * Math.PI;
    
    progressRing.style.strokeDasharray = `${circumference} ${circumference}`;
    progressRing.style.strokeDashoffset = circumference;
    
    const offset = circumference - (percentage / 100 * circumference);
    progressRing.style.strokeDashoffset = offset;
    
    document.querySelector('.progress-value').textContent = percentage + '%';
}

// ì¹´í…Œê³ ë¦¬ë³„ ë ˆì´ë” ì°¨íŠ¸
function initCategoryRadarChart(categoryStats) {
    const ctx = document.getElementById('categoryRadarChart').getContext('2d');
    
    const categories = Object.keys(categoryStats);
    const completionRates = categories.map(cat => {
        const stats = categoryStats[cat];
        return stats.total > 0 ? (stats.completed / stats.total * 100) : 0;
    });
    
    new Chart(ctx, {
        type: 'radar',
        data: {
            labels: categories.map(cat => CONFIG.CATEGORIES[cat]?.name || cat),
            datasets: [{
                label: 'ë‹¬ì„±ë¥ ',
                data: completionRates,
                backgroundColor: 'rgba(0, 122, 255, 0.2)',
                borderColor: '#007AFF',
                borderWidth: 2,
                pointBackgroundColor: '#007AFF'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    beginAtZero: true,
                    max: 100,
                    ticks: {
                        callback: value => value + '%'
                    }
                }
            }
        }
    });
    
    // ì¹´í…Œê³ ë¦¬ë³„ ì§„í–‰ë¥  ë°” ì—…ë°ì´íŠ¸
    categories.forEach(cat => {
        const item = document.querySelector(`[data-category="${cat}"]`);
        if (item) {
            const stats = categoryStats[cat];
            item.querySelector('.category-stats').textContent = `${stats.completed}/${stats.total}`;
            const percentage = stats.total > 0 ? (stats.completed / stats.total * 100) : 0;
            item.querySelector('.category-progress-fill').style.width = percentage + '%';
        }
    });
}

// ë·° ì „í™˜
document.querySelectorAll('.view-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const view = this.dataset.view;
        
        // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
        document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // ë·° ì „í™˜
        document.querySelectorAll('.timeline-view, .heatmap-view, .trend-view').forEach(v => {
            v.style.display = 'none';
        });
        document.getElementById(view + 'View').style.display = 'block';
    });
});

// ê¸°ê°„ í•„í„°
document.querySelectorAll('.period-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        const period = this.dataset.period;
        
        // ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // ë°ì´í„° í•„í„°ë§ ë° ì°¨íŠ¸ ì—…ë°ì´íŠ¸
        filterDataByPeriod(period);
    });
});

// ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸ ìƒì„±
function generatePersonalizedInsights(goals, stats) {
    // ê°•ì  ë¶„ì„
    const strengthText = analyzeStrengths(goals, stats);
    document.getElementById('strengthAnalysis').textContent = strengthText;
    
    // íŒ¨í„´ ë°œê²¬
    const patternText = discoverPatterns(goals);
    document.getElementById('patternAnalysis').textContent = patternText;
    
    // ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ
    const suggestionText = suggestNextSteps(goals, stats);
    document.getElementById('nextStepSuggestion').textContent = suggestionText;
}

// ë‹¬ì„± ì˜ˆì¸¡
function calculateForecast(stats) {
    const completionRate = stats.completed / stats.total;
    const daysElapsed = calculateDaysSinceStart();
    const goalsPerDay = stats.completed / daysElapsed;
    
    const remainingGoals = stats.total - stats.completed;
    const daysToComplete = remainingGoals / goalsPerDay;
    
    const expectedDate = new Date();
    expectedDate.setDate(expectedDate.getDate() + daysToComplete);
    
    document.getElementById('expectedCompletion').textContent = `${Math.ceil(daysToComplete)}ì¼ í›„`;
    document.getElementById('completionDate').textContent = expectedDate.toLocaleDateString('ko-KR');
    document.getElementById('weeklyTarget').textContent = `ì£¼ ${Math.ceil(goalsPerDay * 7)}ê°œ`;
}
</script>
